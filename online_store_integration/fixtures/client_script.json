[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Online Store",
  "enabled": 1,
  "modified": "2026-01-28 15:01:53.706015",
  "module": "Online Store Integration",
  "name": "OSI Online Store JSON Table",
  "script": "frappe.ui.form.on('Online Store', {\r\n  refresh(frm) {\r\n    frm.trigger('render_json_table');\r\n  },\r\n\r\n  raw_shop_info_json(frm) {\r\n    frm.trigger('render_json_table');\r\n  },\r\n\r\n  render_json_table(frm) {\r\n    const htmlField = 'raw_data_table';\r\n    const raw = frm.doc.raw_payload_json;\r\n\r\n    if (!raw) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">No JSON yet</div>');\r\n      return;\r\n    }\r\n\r\n    let data;\r\n    try {\r\n      data = typeof raw === 'string' ? JSON.parse(raw) : raw;\r\n    } catch (e) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-danger\">Invalid JSON</div>');\r\n      return;\r\n    }\r\n\r\n    const esc = (s) => String(s ?? '')\r\n      .replaceAll('&', '&amp;')\r\n      .replaceAll('<', '&lt;')\r\n      .replaceAll('>', '&gt;')\r\n      .replaceAll('\"', '&quot;')\r\n      .replaceAll(\"'\", '&#39;');\r\n\r\n    const isUrl = (s) => typeof s === 'string' && /^https?:\\/\\/\\S+$/i.test(s.trim());\r\n    const isImageUrl = (s) =>\r\n      isUrl(s) && (\r\n        /\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/i.test(s) ||\r\n        /(image|img|logo|thumbnail|avatar|picsum)/i.test(s)\r\n      );\r\n\r\n    const cellHtml = (key, v) => {\r\n      const isObj = v && typeof v === 'object';\r\n\r\n      // nested objects/arrays\r\n      if (isObj) {\r\n        const text = JSON.stringify(v, null, 2);\r\n        return `<pre style=\"margin:0;white-space:pre-wrap;word-break:break-word;\">${esc(text)}</pre>`;\r\n      }\r\n\r\n      const text = String(v ?? '').trim();\r\n\r\n      // image thumbnail\r\n      if (key && /logo|image|img|thumbnail|avatar/i.test(key) && isUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // also render image thumbnail if it looks like an image URL (e.g. picsum)\r\n      if (isImageUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // normal URL\r\n      if (isUrl(text)) {\r\n        return `<a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\">${esc(text)}</a>`;\r\n      }\r\n\r\n      // plain text (includes timestamps as raw strings)\r\n      return `<span title=\"${esc(text)}\">${esc(text)}</span>`;\r\n    };\r\n\r\n    // Array of objects => normal table\r\n    const rows = Array.isArray(data)\r\n      ? data\r\n      : (Array.isArray(data?.data) ? data.data : null);\r\n\r\n    if (rows && rows.length && typeof rows[0] === 'object') {\r\n      const columns = Array.from(new Set(rows.flatMap(r => Object.keys(r)))).slice(0, 30);\r\n\r\n      const thead = columns\r\n        .map(c => `<th style=\"position:sticky;top:0;background:#fff;z-index:1;\">${esc(c)}</th>`)\r\n        .join('');\r\n\r\n      const tbody = rows.slice(0, 300).map(r => {\r\n        const tds = columns.map(c => `<td style=\"vertical-align:top;\">${cellHtml(c, r?.[c])}</td>`).join('');\r\n        return `<tr>${tds}</tr>`;\r\n      }).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead><tr>${thead}</tr></thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          Showing ${Math.min(rows.length, 300)} / ${rows.length} rows\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    // Single object => key/value table\r\n    if (data && typeof data === 'object') {\r\n      const keys = Object.keys(data);\r\n\r\n      const tbody = keys.map(k => `\r\n        <tr>\r\n          <td style=\"width:240px;font-weight:600;vertical-align:top;\">${esc(k)}</td>\r\n          <td style=\"vertical-align:top;\">${cellHtml(k, data[k])}</td>\r\n        </tr>\r\n      `).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead>\r\n              <tr>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Field</th>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          ${keys.length} fields\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">JSON format not supported for table rendering</div>');\r\n  }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Online Product",
  "enabled": 1,
  "modified": "2026-01-28 12:42:11.137632",
  "module": "Online Store Integration",
  "name": "OSI Online Product JSON Table",
  "script": "frappe.ui.form.on('Online Product', {\r\n  refresh(frm) {\r\n    frm.trigger('render_raw_payload_table');\r\n  },\r\n\r\n  raw_payload_json(frm) {\r\n    frm.trigger('render_raw_payload_table');\r\n  },\r\n\r\n  render_raw_payload_table(frm) {\r\n    const htmlField = 'raw_data_table';\r\n    const raw = frm.doc.raw_payload_json;\r\n\r\n    if (!raw) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">No JSON yet</div>');\r\n      return;\r\n    }\r\n\r\n    let data;\r\n    try {\r\n      data = typeof raw === 'string' ? JSON.parse(raw) : raw;\r\n    } catch (e) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-danger\">Invalid JSON</div>');\r\n      return;\r\n    }\r\n\r\n    const esc = (s) => String(s ?? '')\r\n      .replaceAll('&', '&amp;')\r\n      .replaceAll('<', '&lt;')\r\n      .replaceAll('>', '&gt;')\r\n      .replaceAll('\"', '&quot;')\r\n      .replaceAll(\"'\", '&#39;');\r\n\r\n    const isUrl = (s) => typeof s === 'string' && /^https?:\\/\\/\\S+$/i.test(s.trim());\r\n    const isImageUrl = (s) =>\r\n      isUrl(s) && (\r\n        /\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/i.test(s) ||\r\n        /(image|img|logo|thumbnail|avatar|picsum|shopee|lazada|cdn|cf\\.)/i.test(s)\r\n      );\r\n\r\n    const looksLikeJsonString = (s) => {\r\n      if (typeof s !== 'string') return false;\r\n      const t = s.trim();\r\n      return (t.startsWith('{') && t.endsWith('}')) || (t.startsWith('[') && t.endsWith(']'));\r\n    };\r\n\r\n    const tryParseJsonString = (s) => {\r\n      if (!looksLikeJsonString(s)) return null;\r\n      try {\r\n        return JSON.parse(s);\r\n      } catch (e) {\r\n        return null;\r\n      }\r\n    };\r\n\r\n    const renderUrlListAsThumbs = (urls) => {\r\n      const items = urls.slice(0, 24).map(u => {\r\n        const safe = String(u ?? '').trim();\r\n        if (!isUrl(safe)) return `<div style=\"font-size:12px;\">${esc(safe)}</div>`;\r\n\r\n        return `\r\n          <a href=\"${esc(safe)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(safe)}\" style=\"display:block;\">\r\n            <img src=\"${esc(safe)}\"\r\n                 style=\"width:54px;height:54px;object-fit:cover;border-radius:10px;border:1px solid #eee;\" />\r\n          </a>\r\n        `;\r\n      }).join('');\r\n\r\n      return `\r\n        <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start;\">\r\n          ${items}\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n          Showing ${Math.min(urls.length, 24)} / ${urls.length} images\r\n        </div>\r\n      `;\r\n    };\r\n\r\n    // Forward declaration (used by renderNested)\r\n    let cellHtml = () => '';\r\n\r\n    const renderNested = (val) => {\r\n      if (Array.isArray(val)) {\r\n        // array of primitives\r\n        if (!val.length || typeof val[0] !== 'object') {\r\n          // all urls => thumbnails\r\n          if (val.length && val.every(x => typeof x === 'string' && isUrl(x))) {\r\n            return renderUrlListAsThumbs(val);\r\n          }\r\n\r\n          const items = val.slice(0, 40).map(x => `<li>${esc(x)}</li>`).join('');\r\n          return `\r\n            <ul style=\"margin:0;padding-left:18px;\">${items}</ul>\r\n            <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n              ${Math.min(val.length, 40)} / ${val.length} items\r\n            </div>\r\n          `;\r\n        }\r\n\r\n        // array of objects => nested table\r\n        const cols = Array.from(new Set(val.flatMap(o => Object.keys(o)))).slice(0, 20);\r\n\r\n        const thead = cols.map(c => `<th style=\"background:#fafafa;position:sticky;top:0;\">${esc(c)}</th>`).join('');\r\n        const tbody = val.slice(0, 50).map(o => {\r\n          const tds = cols.map(c => `<td style=\"vertical-align:top;\">${cellHtml(c, o?.[c])}</td>`).join('');\r\n          return `<tr>${tds}</tr>`;\r\n        }).join('');\r\n\r\n        return `\r\n          <div style=\"max-height:280px;overflow:auto;border:1px solid #f0f0f0;border-radius:8px;\">\r\n            <table class=\"table table-bordered\" style=\"margin:0;\">\r\n              <thead><tr>${thead}</tr></thead>\r\n              <tbody>${tbody}</tbody>\r\n            </table>\r\n          </div>\r\n          <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n            Showing ${Math.min(val.length, 50)} / ${val.length} rows\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      // object => nested key/value table\r\n      const keys = Object.keys(val || {});\r\n      const rows = keys.slice(0, 60).map(k => `\r\n        <tr>\r\n          <td style=\"width:180px;font-weight:600;background:#fafafa;vertical-align:top;\">${esc(k)}</td>\r\n          <td style=\"vertical-align:top;\">${cellHtml(k, val[k])}</td>\r\n        </tr>\r\n      `).join('');\r\n\r\n      return `\r\n        <div style=\"max-height:280px;overflow:auto;border:1px solid #f0f0f0;border-radius:8px;\">\r\n          <table class=\"table table-bordered\" style=\"margin:0;\">\r\n            <tbody>${rows}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n          ${Math.min(keys.length, 60)} / ${keys.length} fields\r\n        </div>\r\n      `;\r\n    };\r\n\r\n    cellHtml = (key, v) => {\r\n      // 1) If it's a JSON string (like attribute_list_json), parse it and render nested\r\n      if (typeof v === 'string') {\r\n        const parsed = tryParseJsonString(v);\r\n        if (parsed !== null) {\r\n          return renderNested(parsed);\r\n        }\r\n      }\r\n\r\n      // 2) nested objects/arrays => nested renderer\r\n      if (v && typeof v === 'object') {\r\n        // special: image_url_list array => thumbs\r\n        if (key && /image_url_list/i.test(key) && Array.isArray(v)) {\r\n          return renderUrlListAsThumbs(v);\r\n        }\r\n        return renderNested(v);\r\n      }\r\n\r\n      const text = String(v ?? '').trim();\r\n\r\n      // image thumbnail for obvious image-ish keys\r\n      if (key && /logo|image|img|thumbnail|avatar|photo|picture|pic/i.test(key) && isUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // thumbnail if url looks image-ish (Shopee URLs included)\r\n      if (isImageUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // normal url\r\n      if (isUrl(text)) {\r\n        return `<a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\">${esc(text)}</a>`;\r\n      }\r\n\r\n      return `<span title=\"${esc(text)}\">${esc(text)}</span>`;\r\n    };\r\n\r\n    // Array-of-objects => normal table\r\n    const rows = Array.isArray(data)\r\n      ? data\r\n      : (Array.isArray(data?.data) ? data.data : null);\r\n\r\n    if (rows && rows.length && typeof rows[0] === 'object') {\r\n      const columns = Array.from(new Set(rows.flatMap(r => Object.keys(r)))).slice(0, 30);\r\n\r\n      const thead = columns\r\n        .map(c => `<th style=\"position:sticky;top:0;background:#fff;z-index:1;\">${esc(c)}</th>`)\r\n        .join('');\r\n\r\n      const tbody = rows.slice(0, 300).map(r => {\r\n        const tds = columns.map(c => `<td style=\"vertical-align:top;\">${cellHtml(c, r?.[c])}</td>`).join('');\r\n        return `<tr>${tds}</tr>`;\r\n      }).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead><tr>${thead}</tr></thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          Showing ${Math.min(rows.length, 300)} / ${rows.length} rows\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    // Single object => key/value table (with nested rendering)\r\n    if (data && typeof data === 'object') {\r\n      const keys = Object.keys(data);\r\n\r\n      const tbody = keys.map(k => `\r\n        <tr>\r\n          <td style=\"width:240px;font-weight:600;vertical-align:top;\">${esc(k)}</td>\r\n          <td style=\"vertical-align:top;\">${cellHtml(k, data[k])}</td>\r\n        </tr>\r\n      `).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead>\r\n              <tr>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Field</th>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          ${keys.length} fields\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">JSON format not supported for table rendering</div>');\r\n  }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Online Sales Order",
  "enabled": 1,
  "modified": "2026-01-28 12:48:23.458037",
  "module": "Online Store Integration",
  "name": "OSI Online Sales Order JSON Table",
  "script": "frappe.ui.form.on('Online Sales Order', {\r\n  refresh(frm) {\r\n    frm.trigger('render_raw_payload_table');\r\n  },\r\n\r\n  raw_payload_json(frm) {\r\n    frm.trigger('render_raw_payload_table');\r\n  },\r\n\r\n  render_raw_payload_table(frm) {\r\n    const htmlField = 'raw_data_table';\r\n    const raw = frm.doc.raw_payload_json;\r\n\r\n    if (!raw) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">No JSON yet</div>');\r\n      return;\r\n    }\r\n\r\n    let data;\r\n    try {\r\n      data = typeof raw === 'string' ? JSON.parse(raw) : raw;\r\n    } catch (e) {\r\n      frm.set_df_property(htmlField, 'options', '<div class=\"text-danger\">Invalid JSON</div>');\r\n      return;\r\n    }\r\n\r\n    const esc = (s) => String(s ?? '')\r\n      .replaceAll('&', '&amp;')\r\n      .replaceAll('<', '&lt;')\r\n      .replaceAll('>', '&gt;')\r\n      .replaceAll('\"', '&quot;')\r\n      .replaceAll(\"'\", '&#39;');\r\n\r\n    const isUrl = (s) => typeof s === 'string' && /^https?:\\/\\/\\S+$/i.test(s.trim());\r\n    const isImageUrl = (s) =>\r\n      isUrl(s) && (\r\n        /\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/i.test(s) ||\r\n        /(image|img|logo|thumbnail|avatar|picsum|shopee|lazada|cdn|cf\\.)/i.test(s)\r\n      );\r\n\r\n    const looksLikeJsonString = (s) => {\r\n      if (typeof s !== 'string') return false;\r\n      const t = s.trim();\r\n      return (t.startsWith('{') && t.endsWith('}')) || (t.startsWith('[') && t.endsWith(']'));\r\n    };\r\n\r\n    const tryParseJsonString = (s) => {\r\n      if (!looksLikeJsonString(s)) return null;\r\n      try {\r\n        return JSON.parse(s);\r\n      } catch (e) {\r\n        return null;\r\n      }\r\n    };\r\n\r\n    const renderUrlListAsThumbs = (urls) => {\r\n      const items = urls.slice(0, 24).map(u => {\r\n        const safe = String(u ?? '').trim();\r\n        if (!isUrl(safe)) return `<div style=\"font-size:12px;\">${esc(safe)}</div>`;\r\n\r\n        return `\r\n          <a href=\"${esc(safe)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(safe)}\" style=\"display:block;\">\r\n            <img src=\"${esc(safe)}\"\r\n                 style=\"width:54px;height:54px;object-fit:cover;border-radius:10px;border:1px solid #eee;\" />\r\n          </a>\r\n        `;\r\n      }).join('');\r\n\r\n      return `\r\n        <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start;\">\r\n          ${items}\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n          Showing ${Math.min(urls.length, 24)} / ${urls.length} images\r\n        </div>\r\n      `;\r\n    };\r\n\r\n    // Forward declaration (used by renderNested)\r\n    let cellHtml = () => '';\r\n\r\n    const renderNested = (val) => {\r\n      if (Array.isArray(val)) {\r\n        // array of primitives\r\n        if (!val.length || typeof val[0] !== 'object') {\r\n          // all urls => thumbnails\r\n          if (val.length && val.every(x => typeof x === 'string' && isUrl(x))) {\r\n            return renderUrlListAsThumbs(val);\r\n          }\r\n\r\n          const items = val.slice(0, 40).map(x => `<li>${esc(x)}</li>`).join('');\r\n          return `\r\n            <ul style=\"margin:0;padding-left:18px;\">${items}</ul>\r\n            <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n              ${Math.min(val.length, 40)} / ${val.length} items\r\n            </div>\r\n          `;\r\n        }\r\n\r\n        // array of objects => nested table\r\n        const cols = Array.from(new Set(val.flatMap(o => Object.keys(o)))).slice(0, 20);\r\n\r\n        const thead = cols.map(c => `<th style=\"background:#fafafa;position:sticky;top:0;\">${esc(c)}</th>`).join('');\r\n        const tbody = val.slice(0, 50).map(o => {\r\n          const tds = cols.map(c => `<td style=\"vertical-align:top;\">${cellHtml(c, o?.[c])}</td>`).join('');\r\n          return `<tr>${tds}</tr>`;\r\n        }).join('');\r\n\r\n        return `\r\n          <div style=\"max-height:280px;overflow:auto;border:1px solid #f0f0f0;border-radius:8px;\">\r\n            <table class=\"table table-bordered\" style=\"margin:0;\">\r\n              <thead><tr>${thead}</tr></thead>\r\n              <tbody>${tbody}</tbody>\r\n            </table>\r\n          </div>\r\n          <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n            Showing ${Math.min(val.length, 50)} / ${val.length} rows\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      // object => nested key/value table\r\n      const keys = Object.keys(val || {});\r\n      const rows = keys.slice(0, 60).map(k => `\r\n        <tr>\r\n          <td style=\"width:180px;font-weight:600;background:#fafafa;vertical-align:top;\">${esc(k)}</td>\r\n          <td style=\"vertical-align:top;\">${cellHtml(k, val[k])}</td>\r\n        </tr>\r\n      `).join('');\r\n\r\n      return `\r\n        <div style=\"max-height:280px;overflow:auto;border:1px solid #f0f0f0;border-radius:8px;\">\r\n          <table class=\"table table-bordered\" style=\"margin:0;\">\r\n            <tbody>${rows}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:4px;font-size:11px;\">\r\n          ${Math.min(keys.length, 60)} / ${keys.length} fields\r\n        </div>\r\n      `;\r\n    };\r\n\r\n    cellHtml = (key, v) => {\r\n      // 1) If it's a JSON string (like attribute_list_json), parse it and render nested\r\n      if (typeof v === 'string') {\r\n        const parsed = tryParseJsonString(v);\r\n        if (parsed !== null) {\r\n          return renderNested(parsed);\r\n        }\r\n      }\r\n\r\n      // 2) nested objects/arrays => nested renderer\r\n      if (v && typeof v === 'object') {\r\n        // special: image_url_list array => thumbs\r\n        if (key && /image_url_list/i.test(key) && Array.isArray(v)) {\r\n          return renderUrlListAsThumbs(v);\r\n        }\r\n        return renderNested(v);\r\n      }\r\n\r\n      const text = String(v ?? '').trim();\r\n\r\n      // image thumbnail for obvious image-ish keys\r\n      if (key && /logo|image|img|thumbnail|avatar|photo|picture|pic/i.test(key) && isUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // thumbnail if url looks image-ish (Shopee URLs included)\r\n      if (isImageUrl(text)) {\r\n        return `\r\n          <a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\"\r\n             style=\"display:inline-flex;align-items:center;gap:8px;\">\r\n            <img src=\"${esc(text)}\"\r\n                 style=\"width:42px;height:42px;object-fit:cover;border-radius:8px;border:1px solid #eee;\" />\r\n            <span class=\"text-muted\" style=\"font-size:12px;\">Open</span>\r\n          </a>\r\n        `;\r\n      }\r\n\r\n      // normal url\r\n      if (isUrl(text)) {\r\n        return `<a href=\"${esc(text)}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${esc(text)}\">${esc(text)}</a>`;\r\n      }\r\n\r\n      return `<span title=\"${esc(text)}\">${esc(text)}</span>`;\r\n    };\r\n\r\n    // Array-of-objects => normal table\r\n    const rows = Array.isArray(data)\r\n      ? data\r\n      : (Array.isArray(data?.data) ? data.data : null);\r\n\r\n    if (rows && rows.length && typeof rows[0] === 'object') {\r\n      const columns = Array.from(new Set(rows.flatMap(r => Object.keys(r)))).slice(0, 30);\r\n\r\n      const thead = columns\r\n        .map(c => `<th style=\"position:sticky;top:0;background:#fff;z-index:1;\">${esc(c)}</th>`)\r\n        .join('');\r\n\r\n      const tbody = rows.slice(0, 300).map(r => {\r\n        const tds = columns.map(c => `<td style=\"vertical-align:top;\">${cellHtml(c, r?.[c])}</td>`).join('');\r\n        return `<tr>${tds}</tr>`;\r\n      }).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead><tr>${thead}</tr></thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          Showing ${Math.min(rows.length, 300)} / ${rows.length} rows\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    // Single object => key/value table (with nested rendering)\r\n    if (data && typeof data === 'object') {\r\n      const keys = Object.keys(data);\r\n\r\n      const tbody = keys.map(k => `\r\n        <tr>\r\n          <td style=\"width:240px;font-weight:600;vertical-align:top;\">${esc(k)}</td>\r\n          <td style=\"vertical-align:top;\">${cellHtml(k, data[k])}</td>\r\n        </tr>\r\n      `).join('');\r\n\r\n      frm.set_df_property(htmlField, 'options', `\r\n        <div style=\"max-height:360px;overflow:auto;border:1px solid #eee;border-radius:8px;\">\r\n          <table class=\"table table-bordered table-hover\" style=\"margin:0;\">\r\n            <thead>\r\n              <tr>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Field</th>\r\n                <th style=\"position:sticky;top:0;background:#fff;z-index:1;\">Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>${tbody}</tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"text-muted\" style=\"margin-top:6px;font-size:12px;\">\r\n          ${keys.length} fields\r\n        </div>\r\n      `);\r\n      return;\r\n    }\r\n\r\n    frm.set_df_property(htmlField, 'options', '<div class=\"text-muted\">JSON format not supported for table rendering</div>');\r\n  }\r\n});\r\n",
  "view": "Form"
 }
]