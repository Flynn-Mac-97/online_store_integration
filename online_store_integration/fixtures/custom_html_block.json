[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"os-topbar\">\r\n  <div class=\"os-topbar__left\">\r\n    <div class=\"os-select\" id=\"osPeriodSelect\">\r\n      <span class=\"octicon octicon-calendar\"></span>\r\n      <span class=\"os-select__label\">This Month</span>\r\n      <span class=\"octicon octicon-chevron-down\"></span>\r\n    </div>\r\n\r\n    <button class=\"os-pill os-pill--solid\" id=\"osRefreshBtn\" type=\"button\">\r\n      <span class=\"octicon octicon-sync\"></span>\r\n      <span>Refresh Data</span>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"os-topbar__right\">\r\n    <span class=\"os-chip os-chip--muted\">Store Status:</span>\r\n\r\n    <span class=\"os-chip os-chip--ok\" id=\"osShopeeChip\">\r\n      Shopee <span class=\"fa fa-circle text-success\"></span>\r\n      <span class=\"os-chip__sub\">(Connected)</span>\r\n    </span>\r\n\r\n    <span class=\"os-chip os-chip--ok\" id=\"osLazadaChip\">\r\n      Lazada <span class=\"fa fa-circle text-success\"></span>\r\n      <span class=\"os-chip__sub\">(Connected)</span>\r\n    </span>\r\n\r\n    <span class=\"os-refresh\" id=\"osLastRefresh\">\r\n      <span class=\"octicon octicon-clock\"></span>\r\n      <span class=\"os-refresh__label\"></span>\r\n      <span class=\"os-refresh__time\" id=\"osLastRefreshTime\">—</span>\r\n    </span>\r\n  </div>\r\n</div>",
  "modified": "2026-01-27 11:56:32.702472",
  "name": "Summary Bar",
  "private": 0,
  "roles": [],
  "script": "(function(){\r\n    // ---- Period selector ----\r\n    const options = [\"This Month\", \"Last 30 Days\", \"Last 7 Days\", \"Today\"];\r\n    let idx = 0;\r\n\r\n    const select = document.getElementById(\"osPeriodSelect\");\r\n    const label = select.querySelector(\".os-select__label\");\r\n\r\n    select.addEventListener(\"click\", () => {\r\n      idx = (idx + 1) % options.length;\r\n      label.textContent = options[idx];\r\n      if (window.frappe) frappe.show_alert({ message: `Period set to ${options[idx]}`, indicator: \"blue\" });\r\n    });\r\n\r\n    // ---- Last refresh helpers ----\r\n    const KEY = \"os_last_refresh_ts\";\r\n    const timeEl = document.getElementById(\"osLastRefreshTime\");\r\n    const refreshBtn = document.getElementById(\"osRefreshBtn\");\r\n\r\n    function format(ts){\r\n      // Prefer Frappe formatting if available\r\n      if (window.frappe && frappe.datetime && frappe.datetime.str_to_user) {\r\n        // We'll store as ISO string; show as user format\r\n        try { return frappe.datetime.str_to_user(ts); } catch(e){}\r\n      }\r\n      // Fallback: browser locale\r\n      const d = new Date(ts);\r\n      if (isNaN(d.getTime())) return \"—\";\r\n      return d.toLocaleString();\r\n    }\r\n\r\n    function setLastRefresh(tsISO){\r\n      timeEl.textContent = format(tsISO);\r\n      try { localStorage.setItem(KEY, tsISO); } catch(e){}\r\n    }\r\n\r\n    // Load existing timestamp (persist across reloads)\r\n    try {\r\n      const saved = localStorage.getItem(KEY);\r\n      if (saved) setLastRefresh(saved);\r\n    } catch(e){}\r\n\r\n    // ---- Refresh click ----\r\n    refreshBtn.addEventListener(\"click\", () => {\r\n      refreshBtn.disabled = true;\r\n\r\n      // TODO: replace this with your frappe.call / webhook\r\n      // Example:\r\n      // frappe.call({\r\n      //   method: \"online_store_integration.api.refresh_all\",\r\n      //   callback: () => { ... },\r\n      //   always: () => { ... }\r\n      // });\r\n\r\n      if (window.frappe) frappe.show_alert({ message: \"Refreshing data…\", indicator: \"green\" });\r\n\r\n      // Demo: pretend refresh finishes after 1s\r\n      setTimeout(() => {\r\n        const nowISO = new Date().toISOString();\r\n        setLastRefresh(nowISO);\r\n        refreshBtn.disabled = false;\r\n        if (window.frappe) frappe.show_alert({ message: \"Refreshed\", indicator: \"green\" });\r\n      }, 1000);\r\n    });\r\n\r\n    // Optional: expose a global so n8n/frappe scripts can update it\r\n    window.OS_SET_LAST_REFRESH = function(tsISO){\r\n      setLastRefresh(tsISO || new Date().toISOString());\r\n    };\r\n  })();",
  "style": "  /* --- Layout --- */\r\n  .os-topbar{\r\n    display:flex;\r\n    justify-content:space-between;\r\n    align-items:center;\r\n    margin: 0;\r\n    padding: 0;\r\n    width:100%;\r\n    background:#fff;\r\n    border: 0;\r\n  }\r\n\r\n  .os-topbar__left,\r\n  .os-topbar__right{\r\n    display:flex;\r\n    align-items:center;\r\n    gap:8px;\r\n    width:100%;\r\n  }\r\n\r\n  .os-topbar__right{\r\n    justify-content:flex-end;\r\n  }\r\n\r\n  /* --- Period selector --- */\r\n  .os-select{\r\n    display:flex;\r\n    align-items:center;\r\n    gap:8px;\r\n    padding:6px 12px;\r\n    border-radius:999px;\r\n    border:1px solid rgba(0,0,0,.15);\r\n    background:#fff;\r\n    cursor:pointer;\r\n    font-size:13px;\r\n    width:auto;\r\n  }\r\n\r\n  .os-select:hover{\r\n    background:#f8f9fa;\r\n  }\r\n\r\n  .os-select__label{\r\n    font-weight:500;\r\n  }\r\n\r\n  /* --- Pills --- */\r\n  .os-pill{\r\n    display:flex;\r\n    align-items:center;\r\n    gap:8px;\r\n    padding:6px 12px;\r\n    border-radius:999px;\r\n    border:1px solid rgba(0,0,0,.12);\r\n    background:#f6f7f9;\r\n    font-size:13px;\r\n    cursor:pointer;\r\n  }\r\n\r\n  /* --- Chips --- */\r\n  .os-chip{\r\n    display:flex;\r\n    align-items:center;\r\n    gap:6px;\r\n    padding:6px 10px;\r\n    border-radius:999px;\r\n    border:1px solid rgba(0,0,0,.12);\r\n    background:#fff;\r\n    font-size:12.5px;\r\n    white-space:nowrap;\r\n  }\r\n\r\n  .os-chip--muted{\r\n    background:#f9fafb;\r\n    color:#6b7280;\r\n  }\r\n\r\n  .os-chip--ok{\r\n    background:#f0fdf4;\r\n    border-color:rgba(16,185,129,.3);\r\n    color:#065f46;\r\n  }\r\n\r\n  .os-chip__sub{\r\n    opacity:.75;\r\n  }\r\n\r\n  /* Make icons align nicely */\r\n  .octicon,\r\n  .fa{\r\n    font-size:14px;\r\n  }"
 }
]